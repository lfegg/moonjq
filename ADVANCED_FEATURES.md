# 新增功能说明

本次更新为 MoonJQ 添加了三个重要的 jq 操作符。

## 1. 切片操作符 `[start:end]`

支持数组和字符串的切片操作，与 Python 语法类似。

### 语法
- `.[start:end]` - 从 start 到 end（不包含 end）
- `.[-2:]` - 负数索引，从倒数第二个到结尾
- `.[2:]` - 从索引 2 到结尾
- `.[:3]` - 从开始到索引 3（不包含）

### 示例
```bash
echo '[0,1,2,3,4,5]' | jq '.[1:4]'
# 输出: [1, 2, 3]

echo '"hello world"' | jq '.[0:5]'
# 输出: "hello"

echo '[0,1,2,3,4]' | jq '.[-2:]'
# 输出: [3, 4]

# 字段访问 + 切片（无需使用管道）
jq '.skills[1:]' file.json
# 输出数组字段的切片

jq '.name[0:4]' file.json
# 输出字符串字段的切片
```

## 2. 递归下降操作符 `..`

递归遍历 JSON 结构中的所有值。

### 语法
- `..` - 返回所有嵌套的值
- `.. | .field?` - 递归查找所有包含指定字段的值

### 示例
```bash
jq '..' file.json
# 输出所有嵌套的值

echo '{"a":{"b":1},"c":{"b":2}}' | jq '.. | .b?'
# 输出: 1, 2（找到所有的 .b 字段）
```

## 3. 可选操作符 `?`

安全访问操作符，当字段不存在或操作失败时不报错，而是返回空结果。

### 语法
- `.field?` - 安全字段访问
- `.[index]?` - 安全索引访问
- `query?` - 任何查询的可选版本

### 示例
```bash
echo '{"a":1}' | jq '.b?'
# 无输出（字段不存在但不报错）

echo '[1,2,3]' | jq '.[10]?'
# 无输出（索引越界但不报错）

echo '{"a":1}' | jq '.b'
# 输出: null（没有 ? 会返回 null）
```

## 组合使用

这些操作符可以与其他 jq 功能组合使用：

```bash
# 切片 + 过滤
echo '[1,2,3,4,5,6,7,8,9]' | jq '.[2:7] | .[] | select(. > 4)'
# 输出: 5, 6, 7

# 递归下降 + 可选
jq '.. | .city?' file.json
# 递归查找所有包含 city 字段的值

# 多重可选
echo '{"a":{"b":{"c":1}}}' | jq '.a?.b?.c?'
# 输出: 1（任何一层不存在都不会报错）
```

## 测试

所有新功能都已通过单元测试：
- `src/advanced_test.mbt` - 包含 9 个测试用例
- 测试通过率: 16/16 ✓

运行演示脚本查看效果：
```powershell
.\tests\demo_advanced.ps1
```
